#!/usr/bin/env python

import functions
import argparse
import signal
import sys
import textwrap

__author__ = 'Bharath Srinivas'
created_on = '01-02-2017'


def lists(arg=None):
    if arg == 'id':
        return functions.list_all_instances(arg)
    else:
        return functions.list_all_instances('name')


def status(arg):
    return functions.state(arg)


def start(arg):
    return functions.start(arg)


def stop(arg):
    return functions.stop(arg)


def signal_handler(signal, handler):
    print '\nYou pressed Ctrl+C!'
    sys.exit(0)

if __name__ == '__main__':
    signal.signal(signal.SIGINT, signal_handler)

    parser = argparse.ArgumentParser(formatter_class=argparse.RawDescriptionHelpFormatter,
                                     description=textwrap.dedent('''The available commands are:
  list        Lists all the instances
  status      Shows the status of the specified instance
  start       Starts the specified instance
  stop        Stops the specified instance
                                     '''))
    subparsers = parser.add_subparsers(dest='cmd', metavar='command',
                                       help='sub-command to run')

    parser.add_argument('-v', '--version', action='version', version='%(prog)s 1.0 initial release',
                        help='shows the version and exit')

    li = subparsers.add_parser('list', description='List description')
    li.add_argument('choice', nargs='?', choices=['id', 'name'], type=str, action='store', default='name',
                    metavar='arg', help='Use id/name to list all instances based on their ID or name')

    st = subparsers.add_parser('status', description='Status description')
    st.add_argument('instance_st', action='store', type=int, metavar='instance',
                    help='The instance\'s number from the list')

    run = subparsers.add_parser('start', description='Start description')
    run.add_argument('st_instance', action='store', type=int, metavar='instance',
                     help='The instance\'s number from the list')

    halt = subparsers.add_parser('stop', description='Stop description')
    halt.add_argument('halt_instance', action='store', type=int, metavar='instance',
                      help='The instance\'s number from the list')

    args = parser.parse_args(['list', '-h'])

    if args.cmd == 'list':
        if args.choice == 'id':
            lists('id')
        else:
            lists(args.choice)

    elif args.cmd == 'status':
        print status(args.instance_st)

    elif args.cmd == 'start':
        print start(args.st_instance)

    elif args.cmd == 'stop':
        print stop(args.halt_instance)
